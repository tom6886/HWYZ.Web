@using Webdiyer.WebControls.Mvc;
@using HWYZ.Models;
@using HWYZ.Context;
@model PagedList<Order>

<div class="table-responsive">
    <table class="table table-hover table-bordered">
        <thead>
            <tr>
                <td>订单号</td>
                @if (UserContext.user.Store == null)
                { 
                    <td>采购单位</td>
                }
                <td>负责人</td>
                <td>联系电话</td>
                <td>下单时间</td>
                <td>订单金额</td>
                <td>订单状态</td>
                <td>操作</td>
            </tr>
        </thead>
        <tbody>
            @{
                foreach (Order item in Model)
                {
                <tr>
                    <td>@item.OrderCode</td>
                    @if (UserContext.user.Store == null)
                    { 
                        <td>@item.StoreName</td>
                    }
                    <td>@item.Creator</td>
                    <td>@item.Tel</td>
                    @if (@item.Status == OrderStatus.BeforeSubmit)
                    {
                        <td>尚未提交</td>
                    }
                    else
                    {
                        <td>@item.SubmitTime</td>
                    }
                    <td>@item.Paid</td>
                    @switch (@item.Status)
                    {
                        case OrderStatus.BeforeSubmit:<td style="color: #337ab7;">待提交</td>; break;
                        case OrderStatus.BeforeSend:<td style="color: #f0ad4e;">待发货</td>; break;
                        case OrderStatus.Sended:<td style="color: #5cb85c;">已发货</td>; break;
                        case OrderStatus.Reject:<td style="color: #d9534f;">驳回</td>; break;
                    }
                    <td data-id="@item.ID">
                        @if (@item.Status == OrderStatus.BeforeSubmit)
                        {
                            <a href="OrderEdit?orderId=@item.ID" target="_blank" class="editOrder">编辑</a>
                            <span>|</span>
                            <a href="javascript:void(0)" class="delOrder">删除</a>
                        }
                        else
                        {
                            <a href="OrderView?orderId=@item.ID" target="_blank" class="editOrder">查看</a>
                        }
                    </td>
                </tr>
                }
            }
        </tbody>
    </table>
</div>

<div class="text-right" style="padding: 10px 15px;">
    @if (Model != null && Model.Count > 0)
    {
        @Ajax.Pager(Model, new PagerOptions { CssClass = "table-page", PageIndexParameterName = "pi", CurrentPagerItemWrapperFormatString = "<span class=\"active\">{0}</span>", NumericPagerItemWrapperFormatString = "<span>{0}</span>", FirstPageText = "首页&nbsp;&nbsp;", PrevPageText = "前一页", NextPageText = "下一页", LastPageText = "&nbsp;&nbsp;尾页" }, new MvcAjaxOptions { UpdateTargetId = "container", HttpMethod = "Post", DataFormId = "form_query" })
    }
</div>
<script type="text/javascript">
    $(function () {
        $(".delOrder").click(function () {
            if (!confirm("您确定要删除此订单？")) { return false; }

            var _this = $(this);

            $.post("order/delOrder", { orderId: _this.parent().data('id') }, function (r) {
                alert(r.msg);

                if (r.code < 0) {
                    return false;
                }

                $("#form_query").submit();
            });
        });
    });
</script>
